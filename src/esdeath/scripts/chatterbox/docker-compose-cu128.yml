services:
  chatterbox-tts-server:
    build:
      context: .
      dockerfile: Dockerfile.cu128
      args:
        RUNTIME: nvidia
    image: chatterbox-tts-server:cu128
    container_name: chatterbox-tts-server-cu128
    ports:
      - "8004:8004"
    volumes:
      - ./model_cache:/app/model_cache
      - ./reference_audio:/app/reference_audio
      - ./outputs:/app/outputs
      - ./voices:/app/voices
      - ./logs:/app/logs
      - ./config.yaml:/app/config.yaml
      - ~/.cache/huggingface:/app/hf_cache
    environment:
      - HF_TOKEN=YOUR_TOKEN_HERE
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    restart: unless-stopped
